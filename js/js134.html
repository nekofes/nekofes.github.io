<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><script>if(self!=top){top.location=self.location;}</script><title>Javascript MEMO</title><script type = "text/javascript" src="../o/run_prettify.js"></script><link href = "../o/prettify.css" type="text/css" rel="stylesheet" /><style>.prettyprint ol.linenums > li {list-style-type: decimal; }.copy-button {display: inline-block; padding: 2px 5px; border: 1px solid #000; border-radius: 3px; text-decoration: none; color: #000; background-color: #ffffcc; }.copy-button:hover {background-color: #ffeb99; }</style></head><body oncontextmenu='return true;'><table><tr><td><label class="toggle-switch"><input type="checkbox" id="toggle"><span class="slider"></span></label></td><td><p id="langText">ç¾åœ¨ã®è¨€èª: æ—¥æœ¬èª</p></td></tr></table><input type="hidden" id="lang" value="0"><a id="n1" href='#' onClick="f2();">æˆ»ã‚‹</a><br><br><table><tr><td style="font-size:150%;font-width:bold;background-color:rgb(143 188 143 / 0.4);"><div id="n2">ajaxã§ç”»åƒã¨ã‚¹ãƒˆãƒ¼ãƒªã‚’è‡ªå‹•è¡¨ç¤º</div></td></tr><tr><td><div id="n3">ajax</div></td></tr></table><br><div id="n4">ajaxã‚’ä½¿ç”¨ã—ãŸã‚¹ãƒˆãƒ¼ãƒªã‚’è¡¨ç¤ºã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚<br>è‡ªå‹•çš„ã«ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚<br></div><br><div id="n5">[ã‚µãƒ³ãƒ—ãƒ«]</div><div id=h1><textarea id="t1" rows=17 cols=80>
[test11.html]
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Ajaxã§ç”»åƒå–å¾—</title>
<style>
#img, #story {
opacity: 0;
transition: opacity 0.5s ease-in-out;
display: block;
}

.visible {
opacity: 1 !important;
}
</style>
</head>
<body>
<img id="img" style="width:200px;height:200px; display: block;">
<div id="story" style="width:300px; display: block;"></div>

<button id="stopBtn">åœæ­¢</button>
<button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>

<script>

</script>
</body>
</html>

[test11.php]
<?php
// ãƒ›ã‚¹ãƒˆåãŒç‰¹å®šã®æ–‡å­—åˆ—ã§çµ‚ã‚ã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
$host = $_SERVER['HTTP_HOST'];
$checkURL = "localhost";

if (substr($host, -strlen($checkURL)) !== $checkURL) 
{
    header("HTTP/1.1 403 Forbidden");
    exit("Forbidden");
}
$data = json_decode(file_get_contents("php://input"), true);
$no = $data["no"] ?? 0;
$lang = $data["lang"] ?? 0;
if ($no < 0 || $no > 7) {
  http_response_code(404);
  exit;
}

header("Content-Type: application/json");
echo json_encode(["story" => storyText($lang,$no)]);

function storyText(int $lang,int $pageIndex):string
{
    $story="";
    $storyEn="";
    switch($pageIndex)
    {
        case 0:
            $story = "ã“ã‚“ã«ã¡ã¯";
            $storyEn = "Hello";
            break;
        case 1:
            $story = "ãŠã‚„ã€ã©ã†ã—ãŸã‚“ã ã„ï¼Ÿ";
            $storyEn = "Hey, what's wrong?";
            break;
        case 2:
            $story = "ãŠè…¹ã¸ã£ã¡ã‚ƒã£ã¦";
            $storyEn = "I'm hungry";
            break;
        case 3:
            $story = "é‡èœã¯ã©ã†ï¼Ÿ";
            $storyEn = "What about vegetables?";
            break;
        case 4:
            $story = "ãã‚Œã¯ã€ã¡ã‚‡ã£ã¨";
            $storyEn = "That's a bit";
            break;
        case 5:
            $story = "ã‚ãã€ãã†ã„ãˆã°ã“ã‚Œæ‹¾ã£ãŸã‚“ã ã£ãŸã€‚\nï¼ˆã©ã‚“ãã‚Šã‚’å·®ã—å‡ºã™ï¼‰";
            $storyEn = "Ah, that reminds me, I picked this up. \n (Hands over the acorn)";
            break;
        case 6:
            $story = "ã„ã„ã®ï¼Ÿ\nã‚ã‚ŠãŒã¨ã†";
            $storyEn = "Is that okay?\nThank you";
            break;
        case 7:
            $story = "ã©ã†ã„ãŸã—ã¾ã—ã¦\n(ã“ã†ã—ã¦ãã¾ã•ã‚“ã¯æ£®ã¸å¸°ã£ã¦ã„ãã¾ã—ãŸã€‚)";
            $storyEn = "You're welcome.\n(And so the bear returned to the forest.)";
            break;
    }
    return $lang==0?$story : $storyEn;
}
?>

[getImage2.php]
<?php
// ãƒ›ã‚¹ãƒˆåãŒç‰¹å®šã®æ–‡å­—åˆ—ã§çµ‚ã‚ã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
$host = $_SERVER['HTTP_HOST'];
$checkURL = "localhost";

if (substr($host, -strlen($checkURL)) !== $checkURL) 
{
    header("HTTP/1.1 403 Forbidden");
    exit("Forbidden");
}
// CORSè¨­å®š
header("Access-Control-Allow-Origin: http://localhost");
header("Access-Control-Allow-Credentials: true");
// JSONã‚’å—ã‘å–ã‚‹
$data = json_decode(file_get_contents("php://input"), true);
$no = $data["no"] ?? 0;

// ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã®é…åˆ—ï¼ˆå¿…è¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰
$images = [
  "nawmin_sample2.png",
  "nawmin_sample3.png",
  "nawmin_sample4.png",
  "nawmin_sample5.png",
  "nawmin_sample2.png",
  "nawmin_sample3.png",
  "nawmin_sample4.png",
  "nawmin_sample5.png"
];

// ç¯„å›²ãƒã‚§ãƒƒã‚¯
if ($no < 0 || $no >= count($images)) {
  http_response_code(404);
  exit;
}

$filename = $images[$no];
$filepath = __DIR__ . "/" . $filename;

if (file_exists($filepath)) {
  header("Content-Type: image/png");
  readfile($filepath);
} else {
  http_response_code(404);
}
?>

</textarea></div><div id=h2><textarea id="t1" rows=17 cols=80>
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Getting Images via Ajax</title>
<style>
#img, #story {
opacity: 0;
transition: opacity 0.5s ease-in-out;
display: block;
}

.visible {
opacity: 1 !important;
}
</style>
</head>
<body>
<img id="img" style="width:200px;height:200px; display: block;">
<div id="story" style="width:300px; display: block;"></div>

<button id="stopBtn">Stop</button>
<button id="resetBtn">Reset</button>

<script>

</script>
</body>
</html>

[test11.php]
<?php
// Check if the hostname ends with a specific string
$host = $_SERVER['HTTP_HOST'];
$checkURL = "localhost";

if (substr($host, -strlen($checkURL)) !== $checkURL)
{
	header("HTTP/1.1 403 Forbidden");
	exit("Forbidden");
}
$data = json_decode(file_get_contents("php://input"), true);
$no = $data["no"] ?? 0;
$lang = $data["lang"] ?? 0;
if ($no < 0 || $no > 7) {
	http_response_code(404);
	exit;
}

header("Content-Type: application/json");
echo json_encode(["story" => storyText($lang,$no)]);

function storyText(int $lang,int $pageIndex):string
{
	$story="";
	$storyEn="";
	switch($pageIndex)
	{
	case 0:
		$story = "Hello";
		$storyEn = "Hello";
		break;
	case 1:
		$story = "Hey, what's wrong?";
		$storyEn = "Hey, what's wrong?";
		break;
	case 2:
		$story = "I'm hungry";
		$storyEn = "I'm hungry";
		break;
	case 3:
		$story = "What about vegetables?";
		$storyEn = "What about vegetables?";
		break;
	case 4:
		$story = "That's a bit";
		$storyEn = "That's a bit";
		break;
	case 5:
		$story = "Oh, that reminds me, I picked this up. (Hands over the acorn)";
		$storyEn = "Ah, that reminds me, I picked this up. (Hands over the acorn)";
		break;
	case 6:
		$story = "Is that okay? Thank you";
		$storyEn = "Is that okay? Thank you";
		break;
	case 7:
		$story = "You're welcome. (And so the bear returned to the forest.)";
		$storyEn = "You're welcome. (And so the bear returned to the forest.)";
		break;
	}
	return $lang==0?$story : $storyEn;
}
?>

[getImage2.php]
<?php
// Check if the hostname ends with a specific string
$host = $_SERVER['HTTP_HOST'];
$checkURL = "localhost";

if (substr($host, -strlen($checkURL)) !== $checkURL)
{
	header("HTTP/1.1 403 Forbidden");
	exit("Forbidden");
}
// CORS settings
header("Access-Control-Allow-Origin: http://localhost");
header("Access-Control-Allow-Credentials: true");
// Receive JSON
$data = json_decode(file_get_contents("php://input"), true);
$no = $data["no"] ?? 0;

// Array of image filenames (adjust as needed)
$images = [
"nawmin_sample2.png", 
"nawmin_sample3.png", 
"nawmin_sample4.png", 
"nawmin_sample5.png", 
"nawmin_sample2.png", 
"nawmin_sample3.png", 
"nawmin_sample4.png", 
"nawmin_sample5.png"
];

// range check
if ($no < 0 || $no >= count($images)) { 
	http_response_code(404); 
	exit;
}

$filename = $images[$no];
$filepath = __DIR__ . "/" . $filename;

if (file_exists($filepath)) { 
	header("Content-Type: image/png"); 
	readfile($filepath);
} else { 
	http_response_code(404);
}
?>
</textarea></div><br><div id=h3><a href="javascript:void(0);" id="copy1" class="copy-button" data-target="codeBlock1">copy</a><pre id="codeBlock1" class="prettyprint linenums;lang-js;">
[test11.html(javascript)]
let pageIndex = 0;
const pageMax = 8;
let timerId = null; //setTimeoutã®IDã‚’ä¿æŒã—ã¾ã™
let isRunning = false;

async function displayScreen() 
{
	if (!isRunning) return;
	
	console.log("ãƒšãƒ¼ã‚¸ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:", pageIndex);
	const imgEl = document.getElementById("img");
	const storyEl = document.getElementById("story");
	
	imgEl.className = "";
	storyEl.className = "";
	
	try {
		const storyRes = await fetch("/img/test11.php", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ no: pageIndex, lang: 0 }),
		});
		const storyData = await storyRes.json();
		console.log("ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å–å¾—æˆåŠŸ:", storyData.story);
		storyEl.innerText = storyData.story;
		fadeIn(storyEl);
	} catch (e) {
		console.error("ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å–å¾—å¤±æ•—:", e);
	}
	
	try {
		const imgRes = await fetch("/img/getImage2.php", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ no: pageIndex }),
		});
		const blob = await imgRes.blob();
		const url = URL.createObjectURL(blob);
		console.log("ç”»åƒURL:", url);
		imgEl.onload = () => fadeIn(imgEl);
		imgEl.src = url;
	} catch (e) {
		console.error("ç”»åƒå–å¾—å¤±æ•—:", e);
	}
	
	// æ¬¡ã®ãƒšãƒ¼ã‚¸ã¸é€²ã‚€å‰ã«ã€çµ‚äº†æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ï¼
	if (pageIndex >= pageMax - 1) {
		console.log("è‡ªå‹•åœæ­¢ã—ã¾ã™ã€‚");
		isRunning = false;
		return; // ã“ã“ã§çµ‚äº†ï¼
	}
	
	pageIndex++;
	timerId = setTimeout(displayScreen, 3000);
}

function fadeIn(element) {
	element.className = "";
	requestAnimationFrame(() => {
		requestAnimationFrame(() => {
			element.classList.add("visible");
			console.log("â†’ .visible ã‚¯ãƒ©ã‚¹è¿½åŠ :", element.id);
		});
	});
}

// åœæ­¢ãƒœã‚¿ãƒ³
document.getElementById("stopBtn").addEventListener("click", () => {
	isRunning = false;
	clearTimeout(timerId);
	console.log("â¹ï¸ åœæ­¢ã—ã¾ã—ãŸ");
});

// ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
document.getElementById("resetBtn").addEventListener("click", () => {
	clearTimeout(timerId);
	pageIndex = 0;
	isRunning = true;
	displayScreen();
	console.log("ğŸ”„ ãƒªã‚»ãƒƒãƒˆã—ã¦å†é–‹ï¼");
});

// æœ€åˆã«ã‚¹ã‚¿ãƒ¼ãƒˆ
isRunning = true;
displayScreen();
</pre></div><div id=h4><a href="javascript:void(0);" id="copy2" class="copy-button" data-target="codeBlock2">copy</a><pre id="codeBlock2" class="prettyprint linenums;lang-js;">
[test11.html(javascript)]
let pageIndex = 0;
const pageMax = 8;
let timerId = null; //Retains the setTimeout ID
let isRunning = false;

async function displayScreen()
{
	if (!isRunning) return;
	
	console.log("Page Index:", pageIndex);
	const imgEl = document.getElementById("img");
	const storyEl = document.getElementById("story");
	
	imgEl.className = "";
	storyEl.className = "";
	
	try {
		const storyRes = await fetch("/img/test11.php", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ no: pageIndex, lang: 0 }),
		});
		const storyData = await storyRes.json();
		console.log("Story successfully retrieved:", storyData.story);
		storyEl.innerText = storyData.story;
		fadeIn(storyEl);
	} catch (e) {
		console.error("Failed to retrieve story:", e);
	}
	
	try {
		const imgRes = await fetch("/img/getImage2.php", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ no: pageIndex }),
		});
		const blob = await imgRes.blob();
		const url = URL.createObjectURL(blob);
		console.log("Image URL:", url);
		imgEl.onload = () => fadeIn(imgEl);
		imgEl.src = url;
	} catch (e) {
		console.error("Failed to retrieve image:", e);
	}
	
	// Check the termination condition before proceeding to the next page!
	if (pageIndex >= pageMax - 1) {
		console.log("Automatically pausing.");
		isRunning = false;
		return; // Stop here!
	}
	
	pageIndex++;
	timerId = setTimeout(displayScreen, 3000);
}

function fadeIn(element) {
	element.className = "";
	requestAnimationFrame(() => {
		requestAnimationFrame(() => {
			element.classList.add("visible");
			console.log("â†’ .visible class added:", element.id);
		});
	});
}

// Stop button
document.getElementById("stopBtn").addEventListener("click", () => {
	isRunning = false;
	clearTimeout(timerId);
	console.log("â¹ï¸ Stopped");
});

// Reset button
document.getElementById("resetBtn").addEventListener("click", () => {
	clearTimeout(timerId);
	pageIndex = 0;
	isRunning = true;
	displayScreen();
	console.log("ğŸ”„ Reset and restart!");
});

// Start at the beginning
isRunning = true;
displayScreen();
</pre></div><br><div id="n6">displayScreen<br>ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°ã§ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">timerId = setTimeout(displayScreen, 3000);</div>æ¬¡ã®ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã„ã‚‹å ´æ‰€ã§ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyRes = await fetch("/img/test11.php", {</div>ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã®ãƒ•ã‚§ãƒƒãƒå‡¦ç†ã‚’ã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">body: JSON.stringify({ no: pageIndex, lang: 0 }),</div>phpã§åˆ¤å®šã™ã‚‹ãŸã‚ã®å€¤ã‚’é€ã£ã¦ã„ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyData = await storyRes.json();</div>ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ã‚’èª­ã¿è¾¼ã‚€æŒ‡ç¤ºã‚’å‡ºã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">storyEl.innerText = storyData.story;</div>å–å¾—ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">requestAnimationFrame(() => {<br>requestAnimationFrame(() => {<br></div>requestAnimationFrame ã‚’2å›ä½¿ã„ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã€Œclasså¤‰æ›´â†’ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³é–‹å§‹ã€ã‚’ç¢ºå®Ÿã«èªè­˜ã•ã›ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const imgRes = await fetch("/img/getImage2.php", {</div>ç”»åƒã‚’èª­ã¿è¾¼ã‚€ãŸã‚ãƒ•ã‚§ãƒƒãƒã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">imgEl.onload = () => fadeIn(imgEl);<br>imgEl.src = url;<br></div>ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²å¾Œã€srcãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç”»åƒã‚’è¨­å®šã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">#img, #story {<br>opacity: 0;<br>transition: opacity 0.5s ease-in-out;<br>display: block;<br>}<br></div>displayã‚’æ˜ç¤ºã—ã¦ãŠãã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">.visible {<br>opacity: 1 !important;<br>}</div>.visible ã« !important ã‚’è¿½åŠ ã—ã¦cssã®ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã«ä¸Šæ›¸ãã•ã‚Œãšã€ç¢ºå®Ÿã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyRes = await fetch("/img/test11.php", {</div>constã‚’å¿˜ã‚Œã¦ storyData = await ... ã ã‘ã ã¨ã€ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã§ä½¿ãˆãšã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">isRunning = false;<br>clearTimeout(timerId);<br></div>åœæ­¢ãƒœã‚¿ãƒ³ã®å‡¦ç†<br>è¡¨ç¤ºã®ãƒ«ãƒ¼ãƒ—ã‚’æ­¢ã‚ã‚‹å‡¦ç†ã§ã™ã€‚<br>isRunningå¤‰æ•°ã‚’falseã«ã™ã‚‹ã“ã¨ã§displayScreené–¢æ•°ã®<br>if (!isRunning) return;<br>åˆ¶å¾¡ã§displayScreenã®å‡¦ç†ã‚’å®Ÿè¡Œã—ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚<br>clearTimeout<br>ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ã‚’åœæ­¢ã—ã¦ã„ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">clearTimeout(timerId);<br>pageIndex = 0;<br>isRunning = true;<br>displayScreen();<br></div>ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å‡¦ç†<br>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’0ã«æˆ»ã—ã¦ã€æœ€åˆã‹ã‚‰å†ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹å‡¦ç†ã§ã™ã€‚<br>clearTimeout<br>ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ã‚’åœæ­¢ã—ã¦ã„ã¾ã™ã€‚<br>pageIndexã‚’0ã«ã™ã‚‹ã“ã¨ã§æœ€åˆã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«å†è¨­å®šã—ã¦ã„ã¾ã™ã€‚<br>isRunningå¤‰æ•°ã«trueã‚’è¨­å®šã™ã‚‹ã“ã¨ã§displayScreené–¢æ•°ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚<br>displayScreenã‚’å®Ÿè¡Œã—ã¦ãƒªã‚»ãƒƒãƒˆã¨ã—ã¦å‡¦ç†ã‚’å†é–‹ã—ã¦ã„ã¾ã™ã€‚<br><br></div><br><br><br><a id="n7" href='#' onClick="f2();">æˆ»ã‚‹</a><br><br><table style='background-color:rgba(220,220,220,255);color:black;text-align:center;'><tr><td style='background-color:rgba(198,198,255,255);color:black;text-align:center;'><b>è‘—ä½œæ¨©æƒ…å ±</b></td></tr><tr class=p2><td align=left >	ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãŠã‚ˆãƒ—ãƒªç­‰ã«æ²è¼‰ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ç­‰ã«ã¤ã„ã¦ã¯ã€ã„ã‹ãªã‚‹ä¿éšœã‚‚ã„ãŸã—ã¾ã›ã‚“ã€‚<br>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãŠã‚ˆã³ã‚¢ãƒ—ãƒªç­‰ã‚’é€šã˜ã¦å…¥æ‰‹ã—ãŸã„ã‹ãªã‚‹æƒ…å ±ã‚‚è¤‡è£½ã€è²©å£²ã€å‡ºç‰ˆã¾ãŸã¯ä½¿ç”¨ã•ã›ãŸã‚Šã€<br>ã¾ãŸã¯å…¬é–‹ã—ãŸã‚Šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚<br>å½“æ–¹ã¯ã€ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãŠã‚ˆã³ã‚¢ãƒ—ãƒªç­‰ã‚’åˆ©ç”¨ã—ãŸã„ã‹ãªã‚‹ç†ç”±ã«ã‚ˆã£ã¦ã®éšœå®³ç­‰ãŒç™ºç”Ÿã—ã¦ã‚‚ã€<br>ãã®çµæœãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãŠã‚ˆã³ã‚¢ãƒ—ãƒªç­‰ã‚’åˆ©ç”¨ã•ã‚ŒãŸæœ¬äººã¾ãŸã¯ä»–ã®ç¬¬ä¸‰è€…ãŒè¢«ã£ãŸæå®³ã«ã¤ã„ã¦<br>ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã‚ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚<br></td></tr></table><style>.marker99ccff{background-color: rgb(153 204 255 / 0.5);}.marker8fbc8f{background-color: rgb(143 188 143 / 0.5);}.markerffd700{background-color: rgb(255 215 0 / 0.5);}.frame {background-color: rgb(240 248 255 / 0.5); border: 3px solid rgb(30 144 255 / 1.00);    padding: 5px;            margin: 10px;            margin-left:0px;word-break:break-all;}.toggle-switch {position: relative;display: inline-block;width: 60px;height: 34px;}.toggle-switch input {display: none;}.slider {position: absolute;cursor: pointer;top: 0; left: 0;right: 0; bottom: 0;background-color: lightgreen; transition: 0.4s;border-radius: 34px;}.slider:before {position: absolute;content: "";height: 26px; width: 26px;left: 4px; bottom: 4px;background-color: white;transition: 0.4s;border-radius: 50%;content:"JP";text-align: center;}input:checked + .slider {background-color: lightblue; }input:checked + .slider:before {transform: translateX(26px);content:"EN";text-align: center;}</style><script>function copyCodeById(targetId) {const codeElement = document.getElementById(targetId);if (!codeElement) {console.error("å¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: " + targetId);return;}const codeText = codeElement.innerText;if (navigator.clipboard && navigator.clipboard.writeText) {navigator.clipboard.writeText(codeText).then(() => {console.log("ã‚³ãƒ”ãƒ¼æˆåŠŸ");}).catch(err => {console.error("ã‚³ãƒ”ãƒ¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", err);});} else {console.error("Clipboard API ã¯ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§åˆ©ç”¨ã§ãã¾ã›ã‚“");}}document.querySelectorAll('.copy-button').forEach(function(button) {button.addEventListener('click', function() {const targetId = this.getAttribute('data-target');copyCodeById(targetId);});});</script><script>let lang = 0; let nextUrlPath="";const text = {ja: {n1:"æˆ»ã‚‹",n2:"ajaxã§ç”»åƒã¨ã‚¹ãƒˆãƒ¼ãƒªã‚’è‡ªå‹•è¡¨ç¤º",n3:"ajax",n4:`ajaxã‚’ä½¿ç”¨ã—ãŸã‚¹ãƒˆãƒ¼ãƒªã‚’è¡¨ç¤ºã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚<br>è‡ªå‹•çš„ã«ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚<br>`,n5:`[ã‚µãƒ³ãƒ—ãƒ«]`,n6:`displayScreen<br>ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°ã§ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">timerId = setTimeout(displayScreen, 3000);</div>æ¬¡ã®ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã„ã‚‹å ´æ‰€ã§ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyRes = await fetch("/img/test11.php", {</div>ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã®ãƒ•ã‚§ãƒƒãƒå‡¦ç†ã‚’ã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">body: JSON.stringify({ no: pageIndex, lang: 0 }),</div>phpã§åˆ¤å®šã™ã‚‹ãŸã‚ã®å€¤ã‚’é€ã£ã¦ã„ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyData = await storyRes.json();</div>ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ã‚’èª­ã¿è¾¼ã‚€æŒ‡ç¤ºã‚’å‡ºã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">storyEl.innerText = storyData.story;</div>å–å¾—ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">requestAnimationFrame(() => {<br>requestAnimationFrame(() => {<br></div>requestAnimationFrame ã‚’2å›ä½¿ã„ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã€Œclasså¤‰æ›´â†’ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³é–‹å§‹ã€ã‚’ç¢ºå®Ÿã«èªè­˜ã•ã›ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const imgRes = await fetch("/img/getImage2.php", {</div>ç”»åƒã‚’èª­ã¿è¾¼ã‚€ãŸã‚ãƒ•ã‚§ãƒƒãƒã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">imgEl.onload = () => fadeIn(imgEl);<br>imgEl.src = url;<br></div>ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²å¾Œã€srcãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç”»åƒã‚’è¨­å®šã—ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">#img, #story {<br>opacity: 0;<br>transition: opacity 0.5s ease-in-out;<br>display: block;<br>}<br></div>displayã‚’æ˜ç¤ºã—ã¦ãŠãã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">.visible {<br>opacity: 1 !important;<br>}</div>.visible ã« !important ã‚’è¿½åŠ ã—ã¦cssã®ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã«ä¸Šæ›¸ãã•ã‚Œãšã€ç¢ºå®Ÿã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyRes = await fetch("/img/test11.php", {</div>constã‚’å¿˜ã‚Œã¦ storyData = await ... ã ã‘ã ã¨ã€ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã§ä½¿ãˆãšã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">isRunning = false;<br>clearTimeout(timerId);<br></div>åœæ­¢ãƒœã‚¿ãƒ³ã®å‡¦ç†<br>è¡¨ç¤ºã®ãƒ«ãƒ¼ãƒ—ã‚’æ­¢ã‚ã‚‹å‡¦ç†ã§ã™ã€‚<br>isRunningå¤‰æ•°ã‚’falseã«ã™ã‚‹ã“ã¨ã§displayScreené–¢æ•°ã®<br>if (!isRunning) return;<br>åˆ¶å¾¡ã§displayScreenã®å‡¦ç†ã‚’å®Ÿè¡Œã—ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚<br>clearTimeout<br>ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ã‚’åœæ­¢ã—ã¦ã„ã¾ã™ã€‚<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">clearTimeout(timerId);<br>pageIndex = 0;<br>isRunning = true;<br>displayScreen();<br></div>ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å‡¦ç†<br>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’0ã«æˆ»ã—ã¦ã€æœ€åˆã‹ã‚‰å†ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹å‡¦ç†ã§ã™ã€‚<br>clearTimeout<br>ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ã‚’åœæ­¢ã—ã¦ã„ã¾ã™ã€‚<br>pageIndexã‚’0ã«ã™ã‚‹ã“ã¨ã§æœ€åˆã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«å†è¨­å®šã—ã¦ã„ã¾ã™ã€‚<br>isRunningå¤‰æ•°ã«trueã‚’è¨­å®šã™ã‚‹ã“ã¨ã§displayScreené–¢æ•°ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚<br>displayScreenã‚’å®Ÿè¡Œã—ã¦ãƒªã‚»ãƒƒãƒˆã¨ã—ã¦å‡¦ç†ã‚’å†é–‹ã—ã¦ã„ã¾ã™ã€‚<br>`,n7:"æˆ»ã‚‹",},en: {n1: "back",n2: "Automatically display images and stories using ajax",n3: "ajax",n4: `This is a sample that displays a story using ajax. <br>Images and text change automatically. <br>`,n5: `[Sample]`,n6: `displayScreen<br>A function that changes the image and text. <br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">timerId = setTimeout(displayScreen, 3000);</div>This is where the next image and text are loaded. <br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyRes = await fetch("/img/test11.php", {</div>Performs a fetch to load the text.<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">body: JSON.stringify({ no: pageIndex, lang: 0 }),</div>Sends a value for PHP to determine.<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyData = await storyRes.json();</div>Issue a command to load the data body. <br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">storyEl.innerText = storyData.story;</div>Display the retrieved text. <br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">requestAnimationFrame(() => {<br>requestAnimationFrame(() => {<br></div>Use requestAnimationFrame twice to ensure that the browser recognizes that the class has changed and the transition has begun. <br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const imgRes = await fetch("/img/getImage2.php", {</div>Fetch to load the image.<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">imgEl.onload = () => fadeIn(imgEl);<br>imgEl.src = url;<br></div>After registering the event, set the image to the src property.<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">#img, #story {<br>opacity: 0;<br>transition: opacity 0.5s ease-in-out;<br>display: block;<br>}<br></div>Specify display explicitly. <br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">.visible {<br>opacity: 1 !important;<br>}</div>Adding !important to .visible ensures that it is displayed without being overwritten by other CSS styles.<br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">const storyRes = await fetch("/img/test11.php", {</div>If you forget the const and just use storyData = await ..., it may not be used outside the scope and may result in an error.<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">isRunning = false;<br>clearTimeout(timerId);<br></div>Stop Button Processing<br>This process stops the display loop.<br>Setting the isRunning variable to false prevents the displayScreen function from executing its <br>if (!isRunning) return;<br>control.<br>clearTimeout<br>Timer processing is stopped.<br><br><div style="background-color:rgb(245 255 250 / 1.0);text-align:left;">clearTimeout(timerId);<br>pageIndex = 0;<br>isRunning = true;<br>displayScreen();<br></div>Reset Button Processing<br>This process resets the index to 0 and restarts from the beginning. <br>clearTimeout<br>Stops timer processing. <br>Setting pageIndex to 0 resets it to start from the beginning. <br>Setting the isRunning variable to true enables the displayScreen function to work. <br>Executes displayScreen to reset and resume processing. <br>`,n7:"back",}};function applyTextAll(lang, divIds) {divIds.forEach((id) => applyText(lang, id));}function getText(lang, divId) {return (text[lang] && text[lang][divId]) ?? (text.ja && text.ja[divId]) ?? '';}function applyText(lang, divId) {const el = document.getElementById(divId);if (!el) return;el.innerHTML = getText(lang, divId);}const ary = ["n1", "n2", "n3", "n4", "n5", "n6", "n7"];document.addEventListener("DOMContentLoaded", () => {const toggle = document.getElementById("toggle");const hiddenLang = document.getElementById("lang");const langText = document.getElementById("langText");f4();toggle.addEventListener("change", () => {changeToggle();});});function changeToggle(){const hiddenLang = document.getElementById("lang");if (toggle.checked) {hiddenLang.value = 1;lang=1;} else {hiddenLang.value = 0;lang=0;}displayLangText();applyTextAll(lang==0?"ja":"en", ary);}function displayLangText(){const hiddenLang = document.getElementById("lang");if (hiddenLang.value == 0) {langText.textContent = "ç¾åœ¨ã®è¨€èª: æ—¥æœ¬èª";} else {langText.textContent = "current language: English";}f3();f0();const obj=document.getElementById('lang');if(obj.value==1){toggle.checked=true;const hiddenLang = document.getElementById("lang");hiddenLang.value = 1;}else{}}function f0(){const obj=document.getElementById('lang');let lang=obj.value;applyTextAll(lang==0?"ja":"en", ary);f4();}function f4(){const obj=document.getElementById('lang');let lang=obj.value;const h1=document.getElementById('h1');const h2=document.getElementById('h2');const h3=document.getElementById('h3');const h4=document.getElementById('h4');if(lang==1){h1.style.display="none";h2.style.display="block";h3.style.display="none";h4.style.display="block";}else{h1.style.display="block";h2.style.display="none";h3.style.display="block";h4.style.display="none";}}function f3(){let o1=new URL(window.location.href);let o2=o1.searchParams;let d=o2.get('lang');const hiddenLang = document.getElementById("lang");if(d==1||hiddenLang.value==1){hiddenLang.value=1;}else{hiddenLang.value=0;}}function f2(){const obj=document.getElementById('lang');let lang=obj.value;window.location.href=urlPath();}function urlPath(){const obj=document.getElementById('lang');let lang=obj.value;nextUrlPath="/js/index.html";return nextUrlPath+"?lang=" + lang;}</script></body></html>
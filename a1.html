<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Ajaxで画像取得</title>
</head>
<body>
<img id="img1" style="width:200px;height:200px;">

<script>
// まず getkey.php からキーを取得
fetch("https://ss1.xrea.com/app.s17.xrea.com/img/getkey.php")
  .then(res => res.json())
  .then(data => {
    // 取得したキーをそのまま image.php に渡す
    const url = "https://ss1.xrea.com/app.s17.xrea.com/img/image.php?file=post.png&key=" + data.key;

    return fetch(url);
  })
  .then(res => {
    if (!res.ok) throw new Error("アクセス拒否");
    return res.blob();
  })
  .then(blob => {
    document.getElementById("img1").src = URL.createObjectURL(blob);
  })
  .catch(err => console.error("画像取得失敗:", err));
</script>
</body>
</html>
